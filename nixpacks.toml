[phases.setup]
nixPkgs = [
  '(php.withExtensions (pe: pe.enabled ++ []))',
  'nginx',
  'libmysqlclient',
  'phpPackages.composer',
]

[phases.install]
cmds = ['composer install --no-dev --optimize-autoloader']

[phases.build]
cmds = ['cp .env.example .env || true', 'php artisan key:generate']

[start]
cmd = 'cp nginx.conf /nginx.conf && (php-fpm -y /etc/php82/php-fpm.conf & nginx -c /nginx.conf)'